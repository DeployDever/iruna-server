gg.toast("Killing ALL apps...")

-- ใช้ `ps` เพื่อหา process ทั้งหมด
local handle = io.popen("ps -A | awk '{print $9}'")
local output = handle:read("*a")
handle:close()

-- แปลง output เป็น list
local apps = {}
for line in string.gmatch(output, "[^\r\n]+") do
  if not line:match("ps") and not line:match("init") and not line:match("zygote") and not line:match("adbd") then
    table.insert(apps, line)
  end
end

-- ใช้ am force-stop หรือ kill
for _, pkg in ipairs(apps) do
  os.execute("am force-stop " .. pkg)
  os.execute("pkill " .. pkg)
end

gg.toast("Bye bye")
